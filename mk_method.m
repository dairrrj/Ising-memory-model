x=10;
nmax=10^3;
spin=[-1 -1 -1 -1 1 1 -1 -1 -1 -1;
      -1 -1 -1 1 1 1 1 -1 -1 -1;
      -1 -1 1 1 -1 -1 1 1 -1 -1;
      -1 1 1 -1 -1 -1 -1 1 1 -1;
      -1 1 1 1 1 1 1 1 1 -1;
       1 1 1 1 1 1 1 1 1 1;
       1 1 1 -1 -1 -1 -1 1 1 1;
       1 1 -1 -1 -1 -1 -1 -1 1 1;
       1 1 -1 -1 -1 -1 -1 -1 1 1;
       1 1 -1 -1 -1 -1 -1 -1 1 1;]
A2=[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1;
    -1 -1 -1 -1 1 -1 -1 -1 -1 -1;
    -1 -1 -1 1 -1 -1 1 -1 -1 -1;
    -1 -1 1 -1 -1 -1 1 -1 -1 -1;
    -1 -1 1 -1 -1 -1 1 -1 -1 -1;
    -1 1 -1 -1 -1 -1 -1 1 -1 -1;
    -1 1 -1 -1 -1 -1 -1 1 -1 -1;
    1 -1 -1 -1 -1 -1 -1 -1 1 -1;
    1 -1 -1 -1 -1 -1 -1 -1 1 -1;
    1 -1 -1 -1 -1 -1 -1 -1 1 -1;]
for it=1:2 
    for N=1:nmax
        dE=0;
        sf=ceil(rand(1,2)*x);
        save mat_sf sf;
        for ii=1:x
            for jj=1:x
                load mat_sf
                if (ii~=sf(1)&jj~=sf(2))
                    dE=2*spin(sf(1),sf(2))*spin(ii,jj)*A2(sf(1),sf(2))*A2(ii,jj)+dE;
                end
            end
        end
    if dE<0
        A2(sf(1),sf(2))=-A2(sf(1),sf(2));
    end
    image((A2)*128); 
    set(gca,'YTickLabel',[],'XTickLabel',[]); 
    axis square; colormap bone; drawnow; 
    end
end
